We are interested in modeling inextensible, slender fibers using slender body theory. Thus our task is to solve the PDE
\begin{equation}
\label{eq:fibevcont}
\frac{\partial \bm{X}}{\partial t} -\bm{U}_0(\bm{X})= \bm{M}\left(\bm{f}^{E}+\bm{\lambda}\right),
\end{equation}
where $\bm{M}$ is a mobility operator that comes from slender body theory and $\bm{U}_0$ is a background flow. $\bm{f}^E$ are the bending forces on the fiber, and $\bm{\lambda}=(T\bm{X}_s)_s$ are tensile forces that act as Lagrange multipliers enforcing inextensibility of the fiber. The fibers are assumed to be free, and are therefore subject to the boundary conditions, $\displaystyle \bm{X}_{ss}\left(s=0,L\right)=\bm{X}_{sss}\left(s=0,L\right)=\bm{0}$. 

\subsection{Slender body theory}
In slender body theory, the 3D slender fiber with aspect ratio $\displaystyle{\epsilon = \frac{r(L/2)}{L}}$ is reduced to a one dimensional curve along the fiber centerline via an asymptotic expansion in $\epsilon$. The slender body mobility operator is given by
\begin{equation}
\label{eq:Msbt}
\bm{M}[\bm{f}](s) =\frac{1}{8\pi \mu}\left( \bm{ \Lambda}[\bm{f}](s)+\bm{J}[\bm{f}](s)\right),
\end{equation}
where $\bm{f}$ is the force per length on the fiber. The first term on the right side of Eq.\ \eqref{eq:Msbt} is the local operator $\bm{\Lambda}$ given by
\begin{equation}
\label{eq:localsbt}
\bm{\Lambda}=-\log{(\epsilon^2 e)}(\bm{I}+\bm{X}_s \bm{X}_s) + 2(\bm{I}-\bm{X}_s \bm{X}_s). 
\end{equation}
Notice that, because the fiber is inextensible, $\bm{X}_s$ is assumed to be a unit vector, and $\bm{X}_s \bm{X}_s$ is an outer product. Using the $\mathcal{O}(\log{\epsilon^2})$ term of $\bm{\Lambda}$ in place of $\bm{M}$ is synonymous with the \textit{local drag model}. In addition, note that the definition of $\bm{\Lambda}$ in Eq.\ \eqref{eq:localsbt} gives a slender body theory that is $\mathcal{O}(\epsilon^2)$ accurate for \textit{ellipsoidal fibers}, that is, fibers whose radius is given by $r(s)=2\epsilon \sqrt{s(L-s)}$, where $s\in[0,L]$. For cylindrical fibers, this form of SBT is $\mathcal{O}(1)$ accurate, and a different form of $\bm{\Lambda}$ must be used to give the same asymptotic accuracy. In particular, for a general radius $r(s)=a(s)\epsilon L$, the local term is given by  
\begin{align}
\bm{\Lambda} =\left(c\left(\frac{2s}{L}-1\right)(\bm{I}+\bm{X}_s\bm{X}_s) +  (\bm{I}-3\bm{X}_s\bm{X}_s)\right)\bm{f}(s)
\end{align}
where
\begin{equation}
c(t) = \log{\left(\frac{2(1-t^2)+2\sqrt{(1-t^2)^2+16\epsilon^2a(t)^2}}{4a(t)^2\epsilon^2}\right)}.
\end{equation}
For a cylindircal fiber $a(t)=1$. This expression is taken from \cite{morifree} and is chosen so that $c(t) < \infty$ at the fiber ends.

For either cylindrical or ellipsoidal fibers, the $\mathcal{O}(1)$ non-local integral operator $\bm{J}$ is given by
\begin{equation}
\label{eq:intsbt}
\bm{J}[f](s) = \int_0^L \left(\frac{\bm{I}+\hat{\bm{R}}(s,s')\hat{\bm{R}}(s,s')}{\norm{\bm{R}(s,s')}}\bm{f}(s') - \frac{\bm{I}+\bm{X}_s(s) \bm{X}_s(s)}{|s-s'|} \bm{f}(s) \right) ds',
\end{equation}
where $\bm{R}(s,s')=\bm{X}(s)-\bm{X}(s')$ and $\hat{\bm{R}}$ is the corresponding unit vector. We will put off study of the non-local integral until a later time. 

\textbf{For the rest of this report, unless otherwise indicated, we set $\bm{M}=\bm{\Lambda}$ in Eq.\ \eqref{eq:localsbt} to compare with the data received from Floren}, which is obtained using a linearly implicit spectral discretization based on Tornberg and Shelley \cite{ts04}.

\subsection{Fiber mechanics}
The bending force on a fiber is given by
\begin{equation}
\label{eq:bforce}
    \bm{f}^E=-E\bm{X}_{ssss} :=\bm{L}\bm{X}
\end{equation}
subject to ``free fiber'' boundary conditions $\displaystyle \bm{X}_{ss}\left(s=0,L\right)=\bm{X}_{sss}\left(s=0,L\right)=\bm{0}$ \cite{ehssan17}. See Section \ref{sec:rsc} for details on how we actually enforce these boundary conditions. For the present moment, we have defined an operator $\bm{L}$ in Eq.\ \eqref{eq:bforce} that gives the bending force with the correct boundary conditions. 

It is easy to see that these BCs cause the total force and torque from $\bm{f}^E$ on the fiber to be zero in the continuum sense
\begin{equation}
\label{eq:totfe}
\int_{0}^{L} \bm{f}^E \, ds = -E\bm{X}_{sss}\Big \rvert^{L}_{0} = \bm{0}
\end{equation}
and 
\begin{equation}
\label{eq:tottfe}
\left(\int_{0}^{L} \bm{f}^E \times {\bm{X}}\, ds\right)_k = \int_{0}^{L} \left(X^i X^j_{ssss} - X^j X^i _{ssss}\right) \, ds =  \int_{0}^{L} \left(X^i_{ss} X^j_{ss} - X^j_{ss} X^i _{ss}\right) \, ds = 0, 
\end{equation}
where $(i,j,k)$ is a cyclic permutation of $(1,2,3)$. In the torque equation, the free fiber boundary conditions lead to the cancellation of boundary terms.

\subsubsection{Inextensibility}
If the fibers are inextensible, then $s$ is a material parameter, and so $\bm{X}_s \cdot \bm{X}_s=1$ for all time. We follow \cite{ts04} in interchanging $t$ and $s$ derivatives to obtain 
\begin{gather}
\frac{\partial}{\partial t}\left(\bm{X}_s \cdot \bm{X}_s \right) = 0\\[2 pt]
\label{eq:inexdt}
\left(\frac{\partial \bm{X}}{\partial t}\right)_s \cdot \bm{X}_s = 0. 
\end{gather}
Therefore, in 3D, if $\bm{n}_1(s)$ and $\bm{n}_2(s)$ are the normal vectors to the fiber centerline, Eq.\ \eqref{eq:inexdt} implies that 
\begin{equation}
\label{eq:defk}
\frac{\partial \bm{X}}{\partial t}(s) = \bm{U}+\int_0^s \left[g_1(s') \bm{n}_1(s') + g_2(s') \bm{n}_2(s')\right]\,ds' := (\bm{K}\bm{g})(s), 
\end{equation}
where $\bm{U}$ is a rigid body translation and $g_1(s), g_2(s)$ are two specific unknown sufficiently smooth scalar-valued functions. Here we have defined a linear operator $\bm{K}$ acting on a vector $\bm{g}=(g_1,g_2,\bm{U})$. 
Substituting Eq.\ \eqref{eq:defk} into Eq.\ \eqref{eq:fibevcont}, we have 
\begin{equation}
\label{eq:svcont}
\left(\bm{K}\bm{g}\right)(s) = \bm{M}\left(\bm{f}^E+\bm{\lambda}\right)+\bm{U}_0(\bm{X}). 
\end{equation}
In \cite{ts04}, the system was closed by substituting Eq.\ \eqref{eq:fibevcont} into Eq.\ \eqref{eq:inexdt} \textit{with the assumption that} $\bm{\lambda}=(T\bm{X}_s)_s$. In that case, which we refer to as the \textit{strong} formulation, an equation can be derived for the line tension $T(s)$ required to maintain inextensibility. This equation involves third and fourth derivatives of $\bm{X}$ (and their products) and can be challenging to solve numerically. We have therefore taken a different approach by subtituting Eq.\ \eqref{eq:defk} into Eq.\ \eqref{eq:fibevcont}. Because our formulation involves integral rather than differential equations, we refer to it as a \textit{weak} formulation of Tornberg and Shelley \cite{ts04}. In fact, taking the derivative of Eq.\ \eqref{eq:svcont} with respect to $s$ and taking the inner product with $\bm{X}_s$ gives the line tension equation of \cite{ts04}. 

\subsection{Pointwise weak formulation}
The weak formulation is completed or closed by imposing the requirement that the constraint forces $\bm{\lambda}$ do no work for any choice of $\bm{g}$. This comes from a physical postulate within the principle of virtual work \cite{varibook}. To impose this constraint, we define an inner product that gives the total dissipated power on the fluid from $\bm{\lambda}$
\begin{align}
\label{eq:powerip}
\mathcal{P}& =\Bigg{\langle} \bm{\lambda},\frac{\partial \bm{X}}{\partial t} \Bigg{\rangle} = \langle \bm{\lambda},\bm{K}\bm{g} \rangle := \int_0^L (\bm{K}\bm{g})(s') \cdot \bm{\lambda}(s') \, ds'\\[2 pt] 
\label{eq:15}
& = \int_0^L \left(\bm{U}+\int_0^{s'} \left[g_1(s) \bm{n}_1(s) + g_2(s) \bm{n}_2(s)\right]\,ds\right) \cdot \bm{\lambda}(s') \, ds'\\[2 pt] 
\label{eq:16}
& = \bm{U} \cdot \int_0^L \bm{\lambda}(s') \, ds' +\int _0^L ds \int_{s}^L \left(g_1(s)\bm{n}_1(s) + g_2(s) \bm{n}_2(s) \right) \cdot \bm{\lambda}(s') \, ds'\\[2 pt]
\label{eq:Kstarcont}
& = \bm{U} \cdot \int_0^L \bm{\lambda}(s') \, ds' + \int_0^L \left(g_1(s)\bm{n}_1(s) + g_2(s) \bm{n}_2(s) \right) \cdot  \left(\int_{s}^L  \bm{\lambda}(s') \, ds'\right) \, ds=0=\langle\bm{K}^*\bm{\lambda},\bm{g}\rangle, 
\end{align}
where $^*$ denotes an adjoint with respect to the inner product for power. Note that Eq.\ \eqref{eq:16} is obtained from Eq.\ \eqref{eq:15} via a simple change of integration variables. In the \textit{pointwise weak formulation}, we enforce Eq.\ \eqref{eq:Kstarcont} for every $s$ along the fiber. Since Eq.\ \eqref{eq:Kstarcont} must hold for all $\bm{U}$ and all sufficiently smooth $g_1$ and $g_2$, we must have that
\begin{equation}
\label{eq:noworkcont}
\bm{K}^* \bm{\lambda}:=\begin{pmatrix} \left(\int_s^L \bm{\lambda}(s')\, ds'\right) \cdot \bm{n}_1(s)\\[2 pt] \left(\int_s^L \bm{\lambda}(s')\, ds'\right) \cdot \bm{n}_2(s)\\[2 pt] \int_0^L \bm{\lambda}(s') ds' \end{pmatrix} = \begin{pmatrix} 0 \\[2 pt] 0\\[2 pt] \bm{0}\end{pmatrix}. 
\end{equation}

We would like to show that this process is equivalent to the assumption that $\bm{\lambda}=(T\bm{X}_s)_s$. The first and second components of Eq.\ \eqref{eq:noworkcont} taken together tell us that $\left(\int_{s}^L  \bm{\lambda}(s') \, ds'\right)$ is orthogonal to both normal vectors. Therefore, $\left(\int_{s}^L  \bm{\lambda}(s') \, ds'\right)$ is in the direction of $\bm{X}_s(s)$ and can be written as
\begin{equation}
\label{eq:tsalm}
\int_{s}^L  \bm{\lambda}(s') \, ds' = -T(s)\bm{X}_s(s),
\end{equation}
for some scalar function $T$ with $T(s=L)=0$. Differentiating both sides of Eq.\ \eqref{eq:tsalm} with respect to $s$, we obtain 
\begin{equation}
\label{eq:lamval}
\bm{\lambda}(s) = \left(T(s)\bm{X}_s(s)\right)_s, 
\end{equation}
which is the form of Tornberg and Shelley \cite{ts04}. Thus our derivation shows that the form of $\bm{\lambda}$ taken by Tornberg and Shelley comes from principle that constraint forces perform no virtual work \cite{varibook}. 

Now, returning to the third constraint in Eq.\ \eqref{eq:noworkcont}, $\int_0^L \bm{\lambda}(s) \, ds=\bm{0}$, and substituting Eq.\ \eqref{eq:lamval} for $\bm{\lambda}$, we obtain 
\begin{equation}
\label{eq:BCT}
T(L)\bm{X}_s(L) - T(0)\bm{X}_s(0)=\bm{0}. 
\end{equation}
Since $T(L)=0$, Eq.\ \eqref{eq:BCT} implies that $T(0)=0$ as well, since neither of the tangent vectors is identically 0. So we obtain $T(0)=T(L)=0$, which is exactly the boundary condition for the line tension equation in Tornberg and Shelley.

\subsection{$L^2$ weak formulation}
\label{sec:numinex}
While the pointwise formulation is useful to show equivalence with Tornberg and Shelley, it is not useful when doing numerical computations. In this section, we therefore introduce an $L^2$ weak formulation.

We begin by writing the unknown functions $g_1$ and $g_2$ in terms of basis functions for $L^2:[0,L]$, 
\begin{equation}
\label{eq:basis}
g_j(s) = \sum_k \alpha_{jk} g_k(s)
\end{equation}
for $j=1, 2$, with $g_k(s)$ sufficiently smooth scalar-valued basis functions on $s \in [0,L]$. Then a semi-continuum representation of Eq.\ \eqref{eq:defk} is given by 
\begin{equation}
\label{eq:du}
   \bm{u}(s)=\frac{\partial \bm{X}}{\partial t}(s) =\bm{U} + \int_0^s \sum_{j=1}^2\sum_k \alpha_{jk} g_k(s') \bm{n}_j(s') \, ds':=(\bm{K}\bm{\alpha})(s),
\end{equation}
where as before $\bm{U}$ is a constant translation and $\bm{\alpha}=(\alpha_{jk},\bm{U})$. We will use a collocation discretization of Eq.\ \eqref{eq:du}, so that the dynamical equation is
\begin{equation}
    \label{eq:veleq}
    \left(\bm{M}(\bm{\lambda} +\bm{L}\bm{X})\right)(s) +\bm{U}_0(\bm{X}(s))= \left(\bm{K} \bm{\alpha}\right)(s). 
\end{equation}
Note that Galerkin approaches are also possible. 

The dynamical equation, Eq.\ \eqref{eq:veleq}, is supplemented by enforcing Eq.\ \eqref{eq:noworkcont} in an $L^2$ weak sense. We begin by substituting the representation of $g_j$ in Eq.\ \eqref{eq:basis} into the power equation, Eq.\ \eqref{eq:15}, to obtain 
\begin{equation}
\label{eq:26}
\mathcal{P} = \langle\bm{K}\bm{\alpha},\bm{\lambda}\rangle=\bm{U} \cdot \int_0^L \bm{\lambda}(s) \, ds + \int_0^L \left(\int_0^{s'} \sum_{j=1}^2\sum_{k} \alpha_{jk} g_k(s) \bm{n}_j(s) \, ds\right)\cdot \bm{\lambda}(s') \, ds' =\langle \bm{\alpha},\bm{K}^*\bm{\lambda}\rangle =0. 
\end{equation}
We therefore have an $L^2$ weak formulation of the no work constraint in Eq.\ \eqref{eq:noworkcont}. In order for Eq.\ \eqref{eq:26} to hold for all $\bm{\alpha}$, we must have that 
\begin{equation}
\label{eq:noworkcontL2}
\bm{K}^* \bm{\lambda}:=\begin{pmatrix} \int_0^L \left(\int_0^{s'} g_k(s) \bm{n}_1(s) \, ds\right)\cdot \bm{\lambda}(s') \, ds'\\[2 pt] \int_0^L \left(\int_0^{s'} g_k(s) \bm{n}_2(s) \, ds\right)\cdot \bm{\lambda}(s') \, ds'\\[2 pt] \int_0^L \bm{\lambda}(s') ds' \end{pmatrix} = \begin{pmatrix} 0 \\[2 pt] 0\\[2 pt] \bm{0}\end{pmatrix}. 
\end{equation}

A saddle-point system can now be written for $\bm{\lambda}$ and $\bm{\alpha}$ by combining Eqs.\ \eqref{eq:veleq} and \eqref{eq:noworkcontL2}, 
\begin{equation}
\label{eq:saddleL2}
    \begin{pmatrix}
    -\bm{M} & \bm{K}\\[4 pt]
    \bm{K}^* & \bm{0}
    \end{pmatrix}
    \begin{pmatrix} 
    \bm{\lambda}\\[4 pt]
    \bm{\alpha}\\[4 pt]
    \end{pmatrix} =  \begin{pmatrix} 
    \bm{M}\bm{L}\bm{X}+\bm{U}_0\\[4 pt]
    \bm{0}\end{pmatrix}.
\end{equation}

Now, we can eliminate $\bm{\lambda}$ by a Schur complement approach. Applying the formal (psuedo)inverse of $\bm{M}$ to both sides of Eq.\ \eqref{eq:veleq} and then applying $\bm{K}^*$ to both sides, we obtain
\begin{equation}
\left(\left(\bm{K}^*\bm{M}^{-1} \bm{K}\right)\bm{g}\right)(s) = \bm{K}^*\left(\bm{f}^E+\bm{M}^{-1}\bm{U}_0\right)=\bm{K}^*\left(\bm{L}\bm{X}+\bm{M}^{-1}\bm{U}_0\right),
\end{equation}
where we have used Eq.\ \eqref{eq:noworkcontL2} to eliminate $\bm{\lambda}$. If we now apply the (pseudo)inverse of the operator $\bm{K}^*\bm{M}^{-1}\bm{K}$, then apply $\bm{K}$ on the left to both sides, we obtain a solution for the velocity of the fiber centerline of the form
\begin{equation}
\frac{\partial \bm{X}}{\partial t}(s) = \left(\bm{K}\bm{g}\right)(s) = \left(\bm{K}\left(\bm{K}^*\bm{M}^{-1}\bm{K}\right)^{-1}\bm{K}^*\right)\left(\bm{L}\bm{X}+\bm{M}^{-1}\bm{U}_0\right):
=\bm{N}\left(\bm{L}\bm{X}+\bm{M}^{-1}\bm{U}_0\right). 
\end{equation}

\subsection{Discrete weak formulation}
We will use a Chebyshev basis to discretize the fiber centerline. That is, 
\begin{equation}
\label{eq:basisD}
g_j(s) = \sum_{k=0}^{N-2} \alpha_{jk} T_k(s), 
\end{equation}
where $T_k(s)$ is the Chebyshev polynomial of the first kind of degree $k$ on $[0,L]$. The fiber is discretized at points $s_i$, $i=1, \dots N$, where in our case $s_i$ is on a type 1 Chebyshev grid (i.e. a grid that does not include the endpoints). 

We then define a matrix $\bm{D}^{+}$ that evaluates the integral in Eq.\ \eqref{eq:du} via some quadrature scheme. In the Chebyshev discretization, this is the pseudo-inverse of the Chebyshev differentiation matrix. The fully discrete form of Eq.\ \eqref{eq:du} is now given by
\begin{gather}
\label{eq:dvel}
\frac{\partial \bm{X}}{\partial t}\left(s_i\right)=  \left(\bm{M}(\bm{\lambda} +\bm{L}\bm{X})\right)(s_i) +\bm{U}_0(\bm{X}(s_i))= \left(\bm{K}\bm{\alpha}\right)(s_i) = \bm{U} +\left(\bm{D}^+ \bm{a}\right)(s_i), \quad \textrm{where} \\[4 pt] a_q= \sum_{j=1}^2\sum_{k=0}^{N-2} \alpha_{jk} T_k(s_q) \bm{n}_j(s_q)
\end{gather}
are (3 of the) elements of a $3N$ vector $\bm{a}$. Here we have defined the \textit{matrix} $\bm{K}(\bm{X})$ which acts on the $2N+1$ vector $\bm{\alpha}$ to give the velocity of the fiber centerline. When we write linear systems, we will always assume that $\bm{U}$ makes up the last three entries of $\bm{\alpha}$.

It is now straightforward to discretize the no work constraint in Eq.\ \eqref{eq:noworkcontL2}. Define a matrix $\bm{I}^*$ that integrates a (vector or scalar) function using Clenshaw-Curtis quadrature on the type 1 Chebyshev grid. Then the fully discrete form of Eq.\ \eqref{eq:noworkcontL2} is 
\begin{equation}
\label{eq:noworkcontFD}
\bm{K}^* \bm{\lambda}=\begin{pmatrix} \bm{I}^* \left(\left(\bm{D}^+(T_k \bm{n}_1)\right) \cdot \bm{\lambda}\right) \\[2 pt] \bm{I}^* \left(\left(\bm{D}^+(T_k \bm{n}_2)\right) \cdot \bm{\lambda}\right)\\[2 pt] \bm{I}^*\bm{\lambda} \end{pmatrix} = \begin{pmatrix} 0 \\[2 pt] 0\\[2 pt] \bm{0}\end{pmatrix},
\end{equation}
which must hold for all $k=0, 1, \dots, N-2$. 

Thus the final saddle-point system of equations for $\bm{\lambda}$ and $\bm{\alpha}$ (the discrete form of Eq.\ \eqref{eq:saddleL2}) can be written by combining Eqs.\ \eqref{eq:dvel} and \eqref{eq:noworkcontFD}, 
\begin{equation}
\label{eq:saddlept}
    \begin{pmatrix}
    -\bm{M} & \bm{K}\\[4 pt]
    \bm{K}^* & \bm{0}
    \end{pmatrix}
    \begin{pmatrix} 
    \bm{\lambda}\\[4 pt]
    \bm{\alpha}\\[4 pt]
    \end{pmatrix} =  \begin{pmatrix} 
    \bm{M}\bm{L}\bm{X}+\bm{U}_0\\[4 pt]
    \begin{pmatrix} \bm{0}\\[4 pt]
    -\bm{I}^* \bm{L}\bm{X} \end{pmatrix}
    \end{pmatrix}.
\end{equation}
This system, which has an obvious saddle-point structure, is not invertible generally because the representation $\bm{K}\bm{\alpha}$ is not necessarily unique. We therefore solve the system in the least squares sense with a tolerance of $10^{-6}$.

Note that in Eq.\ \eqref{eq:saddlept}, the matrices $\bm{M}$ and $\bm{K}$ are functions of $\bm{X}$. That is, $\bm{M}=\bm{M}(\bm{X})$ and $\bm{K}=\bm{K}(\bm{X})$. Finally, observe that in Eq.\ \eqref{eq:saddlept}, we enforce the third component of Eq.\ \eqref{eq:noworkcontFD} up to discretization errors in $\int \bm{f}^E(s) \, ds \approx \bm{I}^*\bm{f}^E=\bm{I}^*\bm{LX}$. Although $\int \bm{f}^E(s) \, ds=\bm{0}$ in the continuous case, this does not necessarily hold discretely. We therefore keep the term $\bm{I}^*\bm{LX}$ in our discretization to enforce the condition that the \textit{total force on the fiber is zero exactly in the discrete setting}.

\textit{Uniqueness of representation}. Next we show why the upper bound on the sum in Eq.\ \eqref{eq:basisD} is $N-2$ via studying the null space of the matrix $\bm{K}$. If $\bm{K}\bm{\alpha}(s_i)=\bm{0}$ for all $i = 1, \dots N$, we look for a condition that ensures $\bm{\alpha}=\bm{0}$. Without loss of generality, suppose that we choose $\bm{n}_1$ to have a zero entry at position $p$ and $\bm{n}_2$ to have a non-zero entry at position $p$. Then we can write the $p$th entry of $\bm{K}\bm{\alpha}$ at $s_i$ as 
\begin{align}
\left(\left(\bm{K}\bm{\alpha}\right)(s_i)\right)^p & = \bm{U} + \sum_{k=0}^{N-2} \bm{D}^+ \left(\alpha_{1k} T_k \cdot 0\right)(s_i) +  \bm{D}^+ \left(\alpha_{2k} T_k n_2^p\right)(s_i)\\[4 pt] & =\bm{U} + \sum_{k=0}^{N-2} \bm{D}^+ \left(\alpha_{2k} T_k n_2^p\right)(s_i) =0
\end{align}
where $n_2^p(s)$ is some nonzero function of $s$. So if $\left(\left(\bm{K}\bm{\alpha}\right)(s_i)\right)^p=0$ for all $i$, then $\left(\left(\bm{K}\bm{\alpha}\right)(s)\right)^p$ has $N$ zeros.  So a necessary condition for an empty null space of $\bm{K}$ is that $\left(\left(\bm{K}\bm{\alpha}\right)(s)\right)^p$ have $N-1$ zeros or less. Because of the integration operator $\bm{D}^+$, this means we can only include polynomials modes up to $N-2$. Note that this is a \textit{necessary} condition, not a suficient one, since in practice we cannot know the form of the normal vectors (those could be high order polynomials). 

\iffalse
As in the continuous case, since this equation must hold for every feasible motion $\bm{U}$ and $\bm{\alpha}$, each term in Eq.\ \eqref{eq:power} must be zero. Let us focus on the last term for now. Discretizing the integral using some quadrature rule at $s_i$ with weights $w_i$,
\begin{align}
    \mathcal{P}_2 &= \sum_{i=1}^{N} \sum_{j=1}^2\sum_{k=0}^{N-2} \alpha_{jk}\bm{D}^+\left(g_k \bm{n}_j\right)(s_i) \cdot \bm{\lambda}(s_i) w_i \\[4 pt]
& = \sum_{k=0}^{N-2} \sum_{j=1}^2 \alpha_{jk} \sum_{i=1}^{N} \bm{D}^+\left(g_k \bm{n_j}\right)(s_i) \cdot \bm{\lambda}(s_i) w_i=0, 
\end{align}
which must hold for any $\alpha_{jk}$. In particular, it must hold for $\alpha_{jk}=\delta_{1j} \alpha_k$ and $\alpha_{jk}=\delta_{2j} \alpha_k$, and so we have that \textit{for each} $j$ \textit{and} $k$, 
\begin{equation}
\label{eq:kstardisc}
    \sum_{i=1}^{N}\bm{D}^+\left(\bm{n}_j g_k\right)(s_i) \, \cdot \bm{\lambda}(s_i) w_i:=\bm{K}^*\bm{\lambda}=0.
\end{equation}
Eq.\ \eqref{eq:kstardisc} defines the bulk of the adjoint condition on $\bm{\lambda}$. It still remains to enforce the first part of Eq.\ \eqref{eq:power}. 

Since $\bm{U}$ is an arbitrary constant, the first term in Eq.\ \eqref{eq:power} can be discretized as
\begin{equation}
\label{eq:IT}
   \bm{0} = \int \bm{\lambda}(s) \, ds \approx \sum_{i=1}^{N} \bm{\lambda}(s_i) w_i := \bm{I}^*\bm{\lambda},
\end{equation}
where we have defined the discrete integration matrix $\bm{I}^*$ which takes a definite integral of a scalar function (whose values are given as a vector) on $[0,L]$. 
\fi

\subsubsection{Determining the elastic forces}
\label{sec:rsc}
The final order of business is to compute $\bm{f}^E=\bm{LX}$ accurately and with the correct boundary conditions. We use rectangular spectral collocation \cite{tref17, dhale15} to determine the operator $\bm{L}$. As already mentioned, we follow the convention of \cite{dhale15} and solve Eq.\ \eqref{eq:saddlept} on a type 1 Chebyshev grid with $N$ points (i.e. the grid where the PDE is posed \textit{does not} include the boundary points). The boundary conditions are imposed by upsampling the relevant quantities to a type 2 Chebyshev grid (that includes the endpoints) with $\tilde{N}=N+4$ points, since there are 4 BCs. This procedure is analogous to using ghost cells in finite difference methods. For the rest of this report, any quantity defined on the type 2 grid is marked with a tilde. Given the values of $\bm{X}$ on a type 1 Chebyshev grid with $N$ points, there is a unique configuration $\tilde{\bm{X}}$ on the type 2 grid that satisfies
\begin{equation}
\label{eq:deftilde}
\begin{pmatrix} \bm{R} \\[2 pt] \bm{B} \end{pmatrix} \tilde{\bm{X}} = \begin{pmatrix} \bm{I}_N \\[2 pt] \bm{0} \end{pmatrix} \bm{X}. 
\end{equation}
Here $\bm{R}$ is the downsampling operator that intepolates the data on the type 1 $N$ point grid from the data on an $\tilde{N}=N+4$ type 2 grid, and $\bm{B}$ is the operator that encodes the boundary conditions $\displaystyle \tilde{\bm{X}}_{ss}\left(s=0,L\right)=\tilde{\bm{X}}_{sss}\left(s=0,L\right)$ on the \textit{type 2 grid}. Because $\bm{R}$ is rectangular, the left hand side of Eq.\ \eqref{eq:deftilde} is invertible and we can therefore write 
\begin{equation}
\label{eq:getX}
\tilde{\bm{X}} = \begin{pmatrix} \bm{R} \\[2 pt] \bm{B} \end{pmatrix}^{-1} \begin{pmatrix} \bm{I}_N \\[2 pt] \bm{0} \end{pmatrix} \bm{X}= \bm{E}\bm{X}.
\end{equation}

Thus for every configuration $\bm{X}$, there is a unique function $\tilde{\bm{X}}$ on the type 2 grid that satisfies Eq.\ \eqref{eq:getX}.  In finite difference schemes, there are unique values of the ``ghost cells'' that allow the boundary stencils to satisfy the BCs to some order. Thus the rectangular spectral collocation method can be thought of as an extension of ghost cell techniques for finite difference methods.  

The function $\tilde{\bm{X}}$ can be used to compute $\bm{f}^E$ in a way consistent with the boundary conditions. That is, $\tilde{\bm{f}}^E=-E\tilde{\bm{X}}_{ssss}$ is computed on the \textit{type 2} grid and then downsampled via the operator $\bm{R}$. This is so that the bending force is computed in a way consistent with the boundary conditions (analogous to using ghost cells at the boundaries to compute the fourth derivative of $\bm{X}$). We write the downsampled bending force as
\begin{equation}
\label{eq:fE}
\bm{f}^E=\bm{R}\tilde{\bm{f}}^E=\bm{R}\tilde{\bm{D}}^4 \tilde{\bm{X}} = \bm{R}\tilde{\bm{D}}^4 \bm{E}\bm{X}:=\bm{L}\bm{X}.
\end{equation}
So that we have defined the bending force on the type 1 grid, $\bm{f}^E=\bm{L}\bm{X}$. Noitice that $\bm{L}$ is a \textit{constant} matrix (not a function of $\bm{X}$). 

\subsection{Evolving the tangent vector $\V{X}_s$}

A good choice of normal vectors that has a clear physical meaning is based on the Euler angles $\theta$ and $\phi$ for the unit tangent vector $\V{X}_s$,
\begin{equation}
\V{X}_s(\theta(s,t),\phi(s,t)) = \begin{pmatrix} \cos{\theta} \cos{\phi}\\[2 pt] \sin{\theta} \cos{\phi} \\[2 pt] \sin{\phi} \end{pmatrix}.
\end{equation}
The choice of normal vectors that is always orthonormal to $\V{X}_s$ on the unit sphere is
\begin{equation}
\label{eq:nangles}
\V{n}_1 =  \begin{pmatrix} -\sin{\theta}\\[2 pt] \cos{\theta}\\[2 pt]0 \end{pmatrix} \qquad \V{n}_2 =  \begin{pmatrix} -\cos{\theta} \sin{\phi}\\[2 pt] -\sin{\theta} \sin{\phi} \\[2 pt] \cos{\phi} \end{pmatrix}. 
\end{equation}
The position of the fiber $\V{X}$ can be recovered by 
\begin{equation}
\label{eq:XfromXs}
\V{X}(s)= \V{X}(0)+\int_0^s \V{X}_s(\theta(s),\phi(s)) \, ds. 
\end{equation}
Notice that, by the right-handedness of the coordinate system
\begin{equation}
\label{eq:Xsupdate}
\V{X}_{st} = g_1(s)\V{n}_1 + g_2(s) \V{n}_2 = \left(g_1(s)\V{n_2}-g_2(s)\V{n}_1\right) \times \V{X}_s:=\V{\Omega}\left(\V{X}_s, \V{\alpha}\right) \times \V{X}_s. 
\end{equation}
<<<<<<< HEAD
Therefore, $\V{\Omega}\left(\V{X}_s, \V{\alpha}\right)=g_1(s)\V{n_2}-g_2(s)\V{n}_1$ can be viewed as a rotational velocity for $\V{X}_s$ on the unit sphere. The notation here indicates that $\V{\alpha}$ determines $g_1$ and $g_2$ and therefore $\V{\Omega}$. We will use this to update the configuration in our temporal integration schemes by rotating the tangent vector $\V{X}_s$ and then computing $\V{X}$ using \eqref{eq:XfromXs}; this strictly enforces inextensibility.

This theory is of course predicated on the smoothness of $\V{n}_1(s)$ and $\V{n}_2(s)$. In Eq.\ \eqref{eq:nangles}, it is clear that this only holds if $\theta$ is single-valued at $\phi=\pi/2$. Otherwise the signs of $\V{n}_1$ and $\V{n}_2$ can oscillate. We therefore set $\theta \left(\phi=\pm \pi/2\right)=0$ (numerically: \texttt{theta(abs((abs(phi)-pi/2)) < 1e-12) =0}). 

\subsection{Thermal Fluctuations}

Let us first summarize the equations of motion in the form most suitable to stochastic evolution on a space of inextensible worm-like chains. 
